/*********************************************************************
              Function Name: Subscription Price Calculation
              Description: This library function is used to calculate Subscription price of line items in a quote.
              Author: Acharya Kumar Satyabrata
              User Story #:
              Date: 8th jan 2019
              ******************************Change Log*****************************
              
*********************************************************************/

result="";
price=0.0;
substype="";
currdate=getdate();

subsfactor=0.0;

res1 = bmql("SELECT Precision from Func_Curr_Prec_Map WHERE Functional_Currency=$currency");

for line in res1
{
 precision=atoi(get(line,"Precision"));
}


// Calculating the difference between Parts End Date and Parts Start Date
days=getdiffindays(partEndDate, partStartDate) + 1 ;
resultset=bmql("SELECT Subscription_Type, MPN, Start_Date,End_Date FROM BRCM_Part_Master_Prc WHERE MPN=$partNo ORDER BY Start_Date ASC");
for res in resultset
{
if(strtojavadate(get(res,"Start_Date"),"yyyy-MM-dd HH:mm:ss") <= currdate AND strtojavadate(get(res,"End_Date"),"yyyy-MM-dd HH:mm:ss") >= currdate)
{
substype=get(res,"Subscription_Type");

resset=bmql("SELECT Subscription_Type, Subscription_Factor FROM BRCM_Subs_Factor WHERE Subscription_Type=$substype");
for each in resset{
subsfactor=atof(get(each,"Subscription_Factor"));
}
}
}
// Calculating Subscription price of line items in a quote
price=(round(atof(partPrice)*subsfactor,precision))*(days/365.0);

result=String(price);
return result;