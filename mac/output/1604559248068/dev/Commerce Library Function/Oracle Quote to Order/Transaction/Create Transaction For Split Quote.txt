/************************************************
Rule Name: Create Transaction For Split Quote
Description: To Create Transaction for Split Quote Functionality
Author: Ramesh Nellimarla
*/

//===============================================
//Create Transaction with stand alone lines
  
//===============================================

lineSelected = false;
result   = "";
response = " ";
transId  = " ";
ret      = " ";
SLArray  = string[];
jsonObj  = json();

for line in transactionLine
{
    if(line.selectLineItem_l == true)
     { lineSelected = true;}
 }
    
//========================================================================

if (lineSelected == true)
{
    for line in transactionLine
    {  
     if(( line._model_variable_name == "") AND ( line._parent_doc_number == "") )
       { 
         jsonput(jsonObj,"partNum",line._part_number);
         jsonput(jsonObj,"partName",line.productName_l);
         jsonput(jsonObj,"quantity",line._price_quantity );         
         jsonput(jsonobj,"documentNum",line._document_number); 
         jsonput(jsonObj,"parentDoc",line._parent_doc_number);  
             
         jsonSALineString = jsontostr(jsonobj);
         append(SLArray,jsonSALineString); 
        }
    }   
   

   if ( NOT isempty(SLArray) )
    {
     TLines = TRUE;
    response = util.createTransction3(SLArray,TLines);    
    
    }else{
      TLines = FALSE;
     response = util.createTransction3(SLArray,TLines);
     
    }
    pos = find(response,"bs_id=");
    startPos = (pos+7);
    endPos= startPos+8;
       
    transId = substring (response,startPos,endPos);
    
    result = transId;
 }
 
 return result;
 
 //====================================End==================================