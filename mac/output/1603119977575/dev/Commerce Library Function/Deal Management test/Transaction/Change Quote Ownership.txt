/********************************************************************
Function Name: Change Quote Ownership
Description: This function is used to set the value for new owner for the quote.
Author: Keerthivasan/Arjun/Raghav
History:     Date          Author                  Comment 
 02/02/2019    Keerthivasan/Arjun/Raghav        Initial version
 05/09/2019    Mrinal Kumar                     Updated to optimize conditions & used string builders
 08/16/2019    Keerthivasan       Added the attribute owner_t for Jira ID:VIPER-119 to fetch the name of the quote owner who has submitted the quote
********************************************************************/

result = "";
isChangeOwner = isChangeOwner_t;
newOwner = newQuoteOwner_t;
newOwnerArr = split(newOwner,"~");
newOwnerEmail = newOwnerArr[1];
newOwnerName = newOwnerArr[0];
quoteOwner=quoteOwner_t;
creator = createdBy_t;
isValidQuoteOwner = "";
salesRegion = "";
salesArea = "";
salesOrg = "";
userLogin = "";
existingOwnerEmailId = QuoteownerEmail_t;
Credentials = "";
url = "";
resetRenewalHDRFlagValue = "";

if(newOwner <> "")
 {
 resultSet = bmql("select Users, SalesRegion, SalesArea, SalesOrg, User_login from BRCM_Users where EMailID=$newOwnerEmail");
 count = 0;
 for each in resultSet
  {
  newOwner = get(each,"Users");
  salesRegion = get(each,"SalesRegion");
  salesArea = get(each,"SalesArea");
  salesOrg = get(each,"SalesOrg");
  userLogin = get(each,"User_login");
  
  count = count + 1;
  break;
  }
 if(count > 0)
  {
  isChangeOwner = "NO";
  //Added the attribute owner_t for Jira ID:VIPER-119 to fetch the name of the quote owner who has submitted the quote
  sb1 = stringbuilder(result, "1~quoteOwner_t~", newOwnerName, "|", "1~owner_t~", newOwnerName, "|","1~quoteOwnerRegion_t~", salesRegion,"|","1~quoteOwnerSubRegion_t~",salesArea,"|","1~quoteOwnerGEO_t~",salesOrg,"|","1~isChangeOwner_t~",isChangeOwner,"|","1~salesRepId_t~",userLogin,"|","1~QuoteownerEmail_t~",newOwnerEmail,"|","");
  result = sbtostring(sb1);
  }
 }
elif(QuoteownerEmail_t <> "") 
 {
 res = bmql("select SalesRegion,SalesArea,SalesOrg,User_login from BRCM_Users where EMailID= $existingOwnerEmailId");
 for each in res
  {
  salesregion = get(each, "SalesRegion");
  salesarea = get(each, "SalesArea");
  salesorg = get(each, "SalesOrg");
  userLogin = get(each,"User_login");
  break;
  }
  //Added the attribute owner_t for Jira ID:VIPER-119 to fetch the name of the quote owner who has submitted the quote
 sb1 = stringbuilder(result, "1~quoteOwnerRegion_t~", salesRegion, "|", "1~quoteOwnerSubRegion_t~", salesArea, "|", "1~quoteOwner_t~", creator, "|","1~owner_t~", creator, "|", "1~quoteOwnerGEO_t~",  salesOrg, "|","1~salesRepId_t~",userLogin,"|","1~QuoteownerEmail_t~",existingOwnerEmailId,"|","1~autoGeneratedRenewalHDRFlag~", resetRenewalHDRFlagValue, "|","");
 
 result = sbtostring(sb1);
 }
 
return result;