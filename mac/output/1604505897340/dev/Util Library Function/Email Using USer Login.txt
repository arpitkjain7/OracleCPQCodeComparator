/******************************************************************************` 
Author : Kavita Lolla
UID - 179
User Story Summary : Webservice to fetch the email of the login id provided.
Date : 04/03/2019
******************************************************************************/
finalString = "";
payload = dict("string");
put(payload,"sessionId", _user_session_id);
put(payload,"login",login);
xmlPayload = "";
//retrieving username and password for web service authentication, file location and end point URL from data table for the corresponding function call
recordset=bmql("SELECT Username,Password,File_Location,SoapEndpoint,SchemaLocation FROM INT_SYSTEM_DETAILS WHERE System='USER_INFO'");
for record in recordset{
 put(payload,"schemaLocation", get(record, "SchemaLocation"));
 put(payload,"USERNAME", get(record, "Username"));
 put(payload,"PASSWORD", get(record, "Password"));
/* auth = username + ":" + password;
 str1 = encodebase64(auth);
 auth="Basic" + " " + str1;
 headersDict = dict("string");
 put(headersDict,"Content-Type","text/xml;charset=UTF-8"); 
 put(headersDict,"Authorization",auth); 
*/
 put(payload,"companyName",_company_name);
 quoteRequest=applytemplate(get(record,"File_Location"),payload,"");
 //service to fetch email based on login 
 xmlPayload = urldatabypost(get(record,"SoapEndpoint"), quoteRequest,"Failed to Connect");
}

xpath = String[1];
xpath[0] = "/soapenv:Envelope/soapenv:Body/bm:getUserResponse/bm:userInfo/bm:email";
output = readxmlmultiple(xmlPayload,xpath);
emails = get(output,xpath[0]);

userEmail = "";
for email in emails
{
 userEmail = email;
}
return userEmail;