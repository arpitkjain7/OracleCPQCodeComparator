/************************************************
Rule Name: ADHOC_DATA_TABLE_UPDATE
Description: This library triggers a logic to update the data table with required information
Author: M Vamsi Krishna
Creation Date: 14-OCT-2020
*/

value = "save";

//code for calling update transaction for soap v2
dictUpdate= dict("string");
userName = "";
pwd = "";
url = "";

//fetching the username, password, template location and url to hit for webservice call
fileLocation ="";
put(dictUpdate,"datatablename",DataTableName);
put(dictUpdate,"companyName",_company_name);
 resultSet = bmql("SELECT Username,Password,File_Location,SoapEndpoint FROM INT_SYSTEM_DETAILS WHERE System='ADHOC_DATA_TABLE_UPDATE'");
 for vals in resultSet{
 userName = get(vals,"Username");
  pwd = get(vals,"Password");
  fileLocation = get(vals,"File_Location");
  url = get(vals,"SoapEndpoint");
 }

// pass values in dictionary 
put(dictUpdate,"companyName",_company_name);
put(dictUpdate,"USERNAME",userName);
put(dictUpdate,"PASSWORD",pwd);
put(dictUpdate,"forLoop",data);

//apply template

retVal = applytemplate(fileLocation,dictUpdate,"Not_Found");
retVal = replace(retVal,"&lt;","<");
retVal = replace(retVal,"&gt;",">");
retVal = replace(retVal,"&quot;","\"");


// post data in the webservice
retVal1 = urldatabypost(url,retVal,"ERROR");



return value;