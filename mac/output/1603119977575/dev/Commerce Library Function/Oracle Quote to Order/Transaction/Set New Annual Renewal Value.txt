/*********************************************************************
Function Name: Sets new annual renewal value for the parts
Description: This library function is used to populate annual renewal value for the parts.
Author: Raghavendra Kumar. Kamparth
Date: 30 APR 2019
 *********************************************************************/
dateFormat = "yyyy-MM-dd HH:mm:ss" ;
dateRegion = "America/Chicago" ;
totalSupportTermDays = 0 ;
coveredProduct = "" ;
dlim ="~";
dend = "|";
output1 ="";

if(lineItemComment <> "" AND linePartNumber <> "")
{

 teststring=lineItemComment;
 obj=json(teststring);
 PartNumber=jsonget(obj,"PartNumber");
 child=jsonget(obj,"child");
 childObj=json(child);
 transactiontype=jsonget(childObj,"transactionType");
 LicenseType=jsonget(childObj,"selectLicenseType");
 supportPartsPicklist=jsonget(childObj,"supportPartsPicklist");//supportPartsPicklist
 coveredProduct = "";
 if (linePartNumber == supportPartsPicklist)
 {
  coveredProduct = PartNumber;
 }
 if(lineContractStartDate == "" or lineContractEndDate == "")
 {
  
  if(jsonget(childObj,"startDate") <> "" and jsonget(childObj,"endDate") <> "" )
  {
   startDateString = jsonget(childObj,"startDate");
   endDateString = jsonget(childObj,"endDate");
   if(find(startDateString,"/") > 0 and find(endDateString,"/") > 0)
   {
    dateFormat = "MM/dd/yyyy HH:mm:ss" ; 
   }
   contractStartDate=strtojavadate(jsonget(childObj,"startDate"), dateFormat, dateRegion);
   contractEndDate=strtojavadate(jsonget(childObj,"endDate"), dateFormat, dateRegion);
   totalSupportTermDays = getdiffindays(contractStartDate,contractEndDate);
   totalSupportTermDays = totalSupportTermDays + 1; 
  }  
 }
 elif(lineContractStartDate <> "" and lineContractEndDate <> "")
 {
  contractStartDate=strtojavadate(lineContractStartDate, dateFormat, dateRegion);
  contractEndDate=strtojavadate(lineContractEndDate, dateFormat, dateRegion);
  totalSupportTermDays = getdiffindays(contractStartDate,contractEndDate);
  totalSupportTermDays = totalSupportTermDays + 1;
 }
 
 if ( dealType == "cADRenewal" OR dealType == "cADStandard")
 {
  if(transactionType == "New" OR transactionType == "Renew" OR transactionType == "Capacity")
  {
   if( (totalSupportTermDays <> 0) AND (licenseType <> "") )
   {
    if(
     (((licenseType == "UMF") OR (licenseType == "Perpetual")) AND coveredProduct <> "")
     OR ( licenseType =="Subscription" AND coveredProduct == "")
       )
    {
     newAnnualRenVal = (extProposedNetPrice/totalSupportTermDays)*365;
     //return newAnnualRenVal;
    }
    if(dealType == "cADRenewal" AND licenseType =="Subscription" AND coveredProduct <> "")
    {
     newAnnualRenVal = (extProposedNetPrice/totalSupportTermDays)*365;
     //return newAnnualRenVal;
    }
   }
  }
 }   
}  
sb1=stringbuilder(output1,document_number,dlim,"newAnnualRenewalValue_l",dlim,string(newAnnualRenVal),dend);
output1=sbtostring(sb1);
return output1;