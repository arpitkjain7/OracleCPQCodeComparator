/************************************************************************************************************
Description: Perform Pricing Calculation, Operating Unit, Approval Flag, Chaneging QUote Ownership & fetch partner roles
Param:       
Return type: string
History:     Date          Author            Comment 
    02/02/2019    Satyabrata Acharya   Modified the library as per best practices
    05/09/2019    Satyabrata Acharya   Optimized code to align with best practices and used string builder
   30-Sept-2019 Arjun Singh     Added the call for library function ("brcm_updatingAutobookAndEStoreEDI") for updating Autobook and eStore/EDI for VIPER-448, VIPER-446, VIPER-452
   10-Oct-2019     Ravi Kumar          VIPER-518: Stated Renewal Default to 'No' for Symantec Commerical Quotes
************************************************************************************************************/

result="";
ret = "";
sb1 = stringbuilder();
sb5 = stringbuilder();
sb6 = stringbuilder();
sb7 = stringbuilder();
sb8 = stringbuilder();
sb9 = stringbuilder();
sb10 = stringbuilder();
sb11 = stringbuilder();
sb12 = stringbuilder();
sb13 = stringbuilder();
sb14 = stringbuilder();
sb15 = stringbuilder();

resetRenewalHDRFlagValue = "";
value = "NO";
dateFormat = "MM/dd/yyyy HH:mm:ss";

if(find(contractStartDate_t,"-") > 0)
 {
 dateFormat = "yyyy-MM-dd HH:mm:ss";
 }

if(quoteType_t<>"contractQuote")
 {
 sb1=stringbuilder(sb1,commerce.populatingOperatingUnit());
 }



if(quoteType_t<>"contractQuote")
 {
starttime=getcurrenttimeinmillis();
 if(status_t<>"APPROVED")
 {
 sb5=stringbuilder(sb5,commerce.pricingLibrary());
 }
  endtime=getcurrenttimeinmillis();
logtime("Save : pricing library",endtime-starttime);

 //if(autoGeneratedRenewalHDRFlag <> "SYM")
 //{
 sb6=stringbuilder(sb6,commerce.changeQuoteOwnership());
 
 //}
 /*else
 {
 //sb14=stringbuilder(sb14,"1","~autoGeneratedRenewalHDRFlag~",resetRenewalHDRFlagValue + "|");
 sb15=stringbuilder(sb15,"1","~owner_t~",createdBy_t + "|");
 }*/
 }

if(quoteType_t<>"contractQuote")
 {
 sb7=sbappend(sb7,commerce.fetchPartnerParterRoleUsingRestService());


 }
 if(status_t<>"APPROVED")
 {
 sb8=stringbuilder(sb8,commerce.setDatesOnQuoteHeader());
 }
 if(quoteType_t=="renewalQuote" and core_t == "Commercial")
 {
 sb10 = stringbuilder(sb10,commerce.updatingFinancialSummaryAttributes_avg());
 }
//Begin : VIPER-518: Stated Renewal Default to 'No' for Symantec Commerical Quotes
if(quoteType_t == "renewalQuote" and core_t == "Commercial")
{
sb13=stringbuilder(sb13,"1","~statedRenewal_t~","No" + "|");
}
//End: VIPER-518: Stated Renewal Default to 'No' for Symantec Commerical Quotes   

//Added the call for library function (brcm_updatingAutobookAndEStoreEDI) for VIPER-448, VIPER-446, VIPER-452 
sb12 = stringbuilder(sb12,commerce.brcm_updatingAutobookAndEStoreEDI());

 
sb9=sbappend(sb1,sb5,sb6,sb7,sb8,sb10,sb11,sb12,sb13,sb14,result); 
result=sbtostring(sb9);

return result;