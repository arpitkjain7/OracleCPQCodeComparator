/************************************************************************************************************
Description: Funcation to populate contract numbers html attibute.
Return type: string
History:     Date          Author             Comment 
      01/02/2019    Ramesh Nellimarla    Modified the library as per best practices
      05/14/2019    Mrinal Kumar         Removed print, removed commented code and added stringbuilder 
      07/24/2019    M Vamsi  Chages made to fix BROCAD2 - 5530
      07/30/2019    Shivendra  Changes made to fix VIBER-219
**************************************************************************/

result = "";

dateformat = "MM/dd/yyyy";
count = 0;
CustNo = customerERPId_t;
ContractStartDt = strtojavadate(contractStartDate_t,dateformat);
ContractEndDt   = strtojavadate(contractEndDate_t,dateformat);
status = "Active";
//VIBER-219-JS updated to update date in contractSelect_t for selected contract Number.
sb1 = stringbuilder(result, "<div><script>$('#updateContractNum').on('click', function(event){event.preventDefault();var SelectedValue = $('#contractNumber option:selected').text();var splitText = SelectedValue.split(' - ');$('#enterContractNumber_t').trigger('change');$('#enterContractNumber_t').val(splitText[0]);$('#enterContractNumber_t').trigger('focus');$('#enterContractNumber_t').trigger('keydown');$('#enterContractNumber_t').trigger('keypress');$('#enterContractNumber_t').trigger('keyup');$('#enterContractNumber_t').trigger('blur');$('#contractSelect_t').trigger('change');$('#contractSelect_t').val(splitText[1]);$('#contractSelect_t').trigger('focus');$('#contractSelect_t').trigger('keydown');$('#contractSelect_t').trigger('keypress');$('#contractSelect_t').trigger('keyup');$('#contractSelect_t').trigger('blur');})</script></div><div class='custom-select-info'><label class='form-label' style='width: 100px'></label><div class='form-element field-wrapper' id='ContractNumber_t' style='padding-left:100px'><div class='menu-attr-wrapper field' message=''><div class='menu-attr'><select class=' form-input  cm-attr-value ' id='contractNumber' name='ContractNumber_t' style='max-width: 100%;'><option value=''></option>");
//changes made to fix BROCAD2 - 5530 - Begining
if(dealType_t == "cADRenewal")
{
rset = bmql("SELECT DISTINCT BRCM_Assets.CONTRACT_NUMBER,CONTRACT_END_DATE FROM BRCM_Assets INNER JOIN BRCM_Assets_EXT ON BRCM_Assets.CONTRACT_NUMBER = BRCM_Assets_EXT.CONTRACT_NUMBER AND BRCM_Assets.SERIAL_NUMBER = BRCM_Assets_EXT.SERIAL_NUMBER AND BRCM_Assets.CONTRACT_LINE_NUM = BRCM_Assets_EXT.CONTRACT_LINE_NUM WHERE BRCM_Assets.LICENSEE_ACNT_NUM = $CustNo AND BRCM_Assets_EXT.ACTIVE_STATUS = $status");

for each in rset{   
      count = count + 1;
             DBendDate   = strtojavadate(get(each,"CONTRACT_END_DATE"),dateformat);
             code = get(each, "CONTRACT_NUMBER") ;
             strEndDate = datetostr(DBendDate,"MM/dd/yyyy");                 
              if(code == enterContractNumber_t){
       sb1 = stringbuilder(sbtostring(sb1),"<option selected='true' value='" + code + "'>" + code + " - " + strEndDate + "</option>");
              }else{      
       sb1 = stringbuilder(sbtostring(sb1),"<option value='"  + code + "'>" + code + " - " + strEndDate + "</option>");
              }
              if(count > 999)
              {
               break;
              } 
     }
}
else
{
rset = bmql("SELECT DISTINCT BRCM_Assets.CONTRACT_NUMBER,CONTRACT_END_DATE FROM BRCM_Assets INNER JOIN BRCM_Assets_EXT ON BRCM_Assets.CONTRACT_NUMBER = BRCM_Assets_EXT.CONTRACT_NUMBER AND BRCM_Assets.SERIAL_NUMBER = BRCM_Assets_EXT.SERIAL_NUMBER AND BRCM_Assets.CONTRACT_LINE_NUM = BRCM_Assets_EXT.CONTRACT_LINE_NUM WHERE BRCM_Assets.INST_OWNER_CUST_NUM = $CustNo AND BRCM_Assets_EXT.ACTIVE_STATUS = $status");

for each in rset{   
      count = count + 1;
             DBendDate   = strtojavadate(get(each,"CONTRACT_END_DATE"),dateformat);
             code = get(each, "CONTRACT_NUMBER") ;
             strEndDate = datetostr(DBendDate,"MM/dd/yyyy");                 
              if(code == enterContractNumber_t){
       sb1 = stringbuilder(sbtostring(sb1),"<option selected='true' value='" + code + "'>" + code + " - " + strEndDate + "</option>");
              }else{      
       sb1 = stringbuilder(sbtostring(sb1),"<option value='"  + code + "'>" + code + " - " + strEndDate + "</option>");
              }
              if(count > 999)
              {
               break;
              } 
     }     
} 
 //changes made to fix BROCAD2 - 5530 - End  
sb1 = stringbuilder(sbtostring(sb1),"</select></div><input id=\"updateContractNum\" type=\"submit\" value=\"Update\"></div></div></div><br>");
result = sbtostring (sb1); 
return result;