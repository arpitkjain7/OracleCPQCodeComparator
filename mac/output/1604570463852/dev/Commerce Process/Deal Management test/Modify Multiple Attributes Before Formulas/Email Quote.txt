newMainframe = 0;
newDistributed=0;
newDistributedEnvironment=0;
newSaas=0;
capMainframe = 0;
capDistributed=0;
capDistributedEnvironment=0;
capSaas=0;
renewMainframe=0;
renewDistributed=0;
renewDistributedEnv=0;
renewSaas=0;
mainframeTable=0;
result="";
dlim="~";
dend="|";


// code written by Shruti to set attributes which will be used for conditionalities in CA Document 

for line in transactionLine{


  if(line.transactionTypeM_l == "New" AND line.pL_l== "MF" AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  newMainframe = newMainframe + 1;
  }
  elif(line.transactionTypeM_l == "New" AND line.pL_l== "ES" AND line.enterEnvironment_l=="" AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  newDistributed = newDistributed + 1;
  }
  elif(line.transactionTypeM_l == "New"  AND line.pL_l== "ES" AND line.enterEnvironment_l<>""  AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  newDistributedEnvironment = newDistributedEnvironment + 1;
  }
  elif(line.transactionTypeM_l == "New"  AND line.productGroup_l == "SaaS" AND NOT(line.dropProduct_l)){
  newSaas = newSaas + 1;
  }
  elif(line.transactionTypeM_l == "Capacity" AND line.pL_l== "MF" AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
 
  capMainframe = capMainframe + 1;
  }
  elif(line.transactionTypeM_l == "Capacity" AND line.pL_l== "ES" AND line.enterEnvironment_l=="" AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
 
  capDistributed = capDistributed + 1;
  }
  
  elif(line.transactionTypeM_l == "Capacity" AND line.pL_l== "ES" AND line.enterEnvironment_l<>""  AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  
  capDistributedEnvironment = capDistributedEnvironment + 1;
  }
  elif(line.transactionTypeM_l == "Capacity" AND line.productGroup_l == "SaaS" AND NOT(line.dropProduct_l)){
  capSaas = capSaas + 1;
  }
  elif((line.transactionTypeM_l == "Renew") AND line.pL_l== "MF" AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  renewMainframe = renewMainframe + 1;
  }
  elif((line.transactionTypeM_l == "Renew") AND line.pL_l== "ES" AND line.enterEnvironment_l=="" AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  renewDistributed = renewDistributed + 1;
  }
  elif((line.transactionTypeM_l == "Renew") AND line.pL_l== "ES" AND line.enterEnvironment_l<>""AND line.productGroup_l <> "SaaS" AND NOT(line.dropProduct_l)){
  renewDistributedEnv = renewDistributedEnv + 1;
  }
  elif((line.transactionTypeM_l == "Renew")  AND line.productGroup_l == "SaaS" AND NOT(line.dropProduct_l)){
  renewSaas = renewSaas + 1;
  }
  elif(line.pL_l=="MF"){
  mainframeTable=mainframeTable+1;
  }
  
 }
address1="";
address2="";
address3="";

              headerRecord=bmql("Select OU,Address1,Address2,Address3 from BRCM_Headers where OU=$operatingUnit_t");
           
              for eachRecord in headerRecord{
               address1= get(eachRecord,"Address1");
        address2= get(eachRecord,"Address2");
    address3= get(eachRecord,"Address3");
      }
      //changes done on  13th June 2019 for jira-  4347     
newOwnerEmail = "";
     
     if(newQuoteOwner_t <> ""){
          newOwner = newQuoteOwner_t;
 newOwnerArr = split(newOwner,"~");
 newOwnerEmail = newOwnerArr[1];
 }
 else{
 newOwnerEmail = QuoteownerEmail_t;
 }
 
 
     emailID = "" ; 
     title = "" ; 
     phNo = "" ;      
     resultSet = bmql("select User_Title, User_PhoneNo, EMailID from BRCM_Users where EMailID=$newOwnerEmail");
     for each in resultSet{
     emailID= get(each,"EMailID");
        title= get(each,"User_Title");
    phNo= get(each,"User_PhoneNo");
     }
     // end of changes
           

sb = stringbuilder();
sbappend(sb,"1~newMainframe_t~",string(newMainframe),"|","1~newDistributed_t~",string(newDistributed),"|","1~newDistributedEnvironment_t~",string(newDistributedEnvironment),"|","1~newSaas_t~",string(newSaas),"|");

sbappend(sb,"1~capacityMainframe_t~",string(capMainframe),"|","1~capacityDistributed_t~",string(capDistributed),"|","1~capacityDistributedEnvironment_t~",string(capDistributedEnvironment),"|","1~capacitySaas_t~",string(capSaas),"|");

sbappend(sb,"1~renewMainfram_t~",string(renewMainframe),"|","1~renewDistributed_t~",string(renewDistributed),"|","1~renewDistributedENvironment_t~",string(renewDistributedEnv),"|","1~renewSaas_t~",string(renewSaas),"|");

sbappend(sb,"1~mainframesTables_avg~",string(mainframesTables_avg),"|");

sbappend(sb,"1~headerLegalAddress_t~",address1,"|","1~headerLegalAddress1_t~",address2,"|","1~headerLegalAddress2_t~",address3,"|");

sbappend(sb,"1~QuoteownerEmail_t~",emailID,"|","1~quoteOwnerPhoneNumber_t~",phNo,"|","1~quoteOwnerTitle_t~",title,"|");

result = sbtostring(sb); 
/*
result= result + _transaction_document_number + dlim + "newMainframe_t" + dlim + string(newMainframe) + dend;
result= result + _transaction_document_number + dlim + "newDistributed_t" + dlim + string(newDistributed) + dend;
result= result + _transaction_document_number + dlim + "newDistributedEnvironment_t" + dlim + string(newDistributedEnvironment) + dend;
result= result + _transaction_document_number + dlim + "newSaas_t" + dlim + string(newSaas) + dend;

result= result + _transaction_document_number + dlim + "capacityMainframe_t" + dlim + string(capMainframe) + dend;
result= result + _transaction_document_number + dlim + "capacityDistributed_t" + dlim + string(capDistributed) + dend;
result= result + _transaction_document_number + dlim + "capacityDistributedEnvironment_t" + dlim + string(capDistributedEnvironment) + dend;
result= result + _transaction_document_number + dlim + "capacitySaas_t" + dlim + string(capSaas) + dend;

result= result + _transaction_document_number + dlim + "renewMainfram_t" + dlim + string(renewMainframe) + dend;
result= result + _transaction_document_number + dlim + "renewDistributed_t" + dlim + string(renewDistributed) + dend;
result= result + _transaction_document_number + dlim + "renewDistributedENvironment_t" + dlim + string(renewDistributedEnv) + dend;
result= result + _transaction_document_number + dlim + "renewSaas_t" + dlim + string(renewSaas) + dend;

result= result + _transaction_document_number + dlim + "mainframesTables_avg" + dlim + string(mainframeTable) + dend;

result= result + _transaction_document_number + dlim + "headerLegalAddress_t" + dlim + address1 + dend;
result= result + _transaction_document_number + dlim + "headerLegalAddress1_t" + dlim + address2 + dend;
result= result + _transaction_document_number + dlim + "headerLegalAddress2_t" + dlim + address3 + dend;

result= result + _transaction_document_number + dlim + "QuoteownerEmail_t" + dlim + _system_user_email + dend;
result= result + _transaction_document_number + dlim + "quoteOwnerPhoneNumber_t" + dlim + _system_user_phone + dend;
result= result + _transaction_document_number + dlim + "quoteOwnerTitle_t" + dlim + _system_user_job_title + dend;
*/
return result;