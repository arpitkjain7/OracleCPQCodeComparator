/********************************************************************
Function Name: Set Line Item Details Config
Description: To Set New Annual Renewal Value in Line Item on Single Save itself for products coming from Both configuration and Quick Add
Author: Keerthivasan A
Date: 03/10/2019
********************************************************************/
result = "";
dlim="~";
dend="|";
dateFormatN = "yyyy-MM-dd HH:mm:ss" ;
output9a="";
output9b="";
startDate = getDate();
endDate = getDate();
newAnnualRenVal = 0.0;
coveredProduct="";
obj = json();

// Calculating only for Products coming from configuration
if(line_item_comment<>"") {
  obj=json(line_item_comment);
  PartNumber=jsonget(obj,"PartNumber");
  child=jsonget(obj,"child");
  childObj=json(child);
  transactiontype=jsonget(childObj,"transactionType");
  licenseType=jsonget(childObj,"selectLicenseType");
  
  // Calculating Total New Support Term Days only when Contract Start Date and End Date Present in line Item
  if(jsonget(childObj,"startDate")<>"" ){
     startDate=strtojavadate(jsonget(childObj,"startDate"), "MM/dd/yyyy HH:mm:ss", "America/Chicago");
  }
  if(jsonget(childObj,"endDate")<>"" ){
    endDate=strtojavadate(jsonget(childObj,"endDate"), "MM/dd/yyyy HH:mm:ss", "America/Chicago");
  }
  
  supportPartsPicklist=jsonget(childObj,"supportPartsPicklist");//supportPartsPicklist
  PartNumber=jsonget(obj,"PartNumber");
  
  if (part_number == supportPartsPicklist)
  {
   coveredProduct = partNumber;
  }
        
  // Calculating Total Support Term (Days) based on Contract Start Date and End Date
  totalSupportTermDays = getdiffindays(endDate,startDate);
  incTotalSupportTermDays = totalSupportTermDays + 1;
  sb9a=stringbuilder(output9a,document_number,"~totalNewSupportTermDays_l~",string(incTotalSupportTermDays),"|");
  output9a=sbtostring(sb9a);
   
   
  // Setting New Annual Renewal Value Only if Deal Type is either ENT-Standard or ENT-Renewal and for Covered Products Alone
  if ( dealType_t == "cADRenewal" OR dealType_t == "cADStandard") {
   if(transactionType == "New" OR transactionType == "Renew" OR transactionType == "Capacity") {
    if( (incTotalSupportTermDays <> 0) AND (licenseType <> "") ) {
     if((((licenseType == "UMF") OR (licenseType == "Perpetual")) AND coveredProduct <> "")
        OR (licenseType =="Subscription" AND coveredProduct == "")
       )
       {
        newAnnualRenVal = (proposedPrice/incTotalSupportTermDays)*365;
       }
       if(dealType_t == "cADRenewal" AND licenseType =="Subscription" AND coveredProduct <> "")
       {
        newAnnualRenVal = (proposedPrice/incTotalSupportTermDays)*365;
       }
      }
     }
  }
  sb9b=stringbuilder(output9b,document_number,"~newAnnualRenewalValue_l~",string(newAnnualRenVal),"|");
  output9b=sbtostring(sb9b);
}
// Calculating only for Products coming from Quick Add
else {
 newAnnualRenVal = 0.0;
 contractEndDatelineObj=getdate();
 contractStartDatelineObj=getdate();
 if(contractEndDateCall<>""){
  contractEndDatelineObj = strtodate(contractEndDateCall, dateFormatN);
 }
 if(contractStartDateCall<>""){
  contractStartDatelineObj = strtodate(contractStartDateCall, dateFormatN);
 }             
 totalSupportTermDays = getdiffindays(contractEndDatelineObj,contractStartDatelineObj);
 incTotalSupportTermDays = totalSupportTermDays + 1;
 sb9a=stringbuilder(output9a,document_number,"~totalNewSupportTermDays_l~",string(incTotalSupportTermDays),"|");
 output9a=sbtostring(sb9a);
 
 // Setting New Annual Renewal Value Only if Deal Type is either ENT-Standard or ENT-Renewal and for Covered Products Alone
 if ( dealType_t == "cADRenewal" OR dealType_t == "cADStandard")
  {
   if(transactionTypeCall == "New" OR transactionTypeCall == "Renew" OR transactionTypeCall == "Capacity")
   {
    if( (incTotalSupportTermDays <> 0) AND (licenseTypeCall <> "") )
    {
     if(
      (((licenseTypeCall == "UMF") OR (licenseTypeCall == "Perpetual")) AND coveredProductCall <> "")
      OR ( licenseTypeCall =="Subscription" AND coveredProductCall == "")
     )
     {
      newAnnualRenVal = (proposedPrice/incTotalSupportTermDays)*365;
     }
     if(dealType_t == "cADRenewal" AND licenseTypeCall =="Subscription" AND coveredProductCall <> "")
     {
      newAnnualRenVal = (proposedPrice/incTotalSupportTermDays)*365;
     }
    }
   }
  }
 sb9b=stringbuilder(output9b,document_number,"~newAnnualRenewalValue_l~",string(newAnnualRenVal),"|");
 output9b=sbtostring(sb9b);
}
 
sb9a=stringbuilder();
sb9b=stringbuilder();
output=stringbuilder(result, output9a, output9b);
result=sbtostring(output);

return result;