/*********************************************************************
              Function Name: Renewal Batch Update
              Description: This function is Update Renewal batch Number After Job Execution Completed
              Author: Ravi
              User Story #:Renewal story
              Date: 30th March 2019
              ******************************Change Log*****************************
           
*********************************************************************/
//================================================================================
//Created by Ravi on March 30 2019 to Update Renewal batch Number After Job Execution Completed
//=================================================================================
usernameFlagUpdate = "";
passwordFlagUpdate = "";
fileLocationFlagUpdate = "";
soapendpointFlagUpdate = "";
usernameFlagDeploy = "";
passwordFlagDeploy = "";
fileLocationFlagDeploy = "";
soapendpointFlagDeploy = "";
renewalBatchDeletePayload = dict("string");

currentsystemDate = datetostr(getdate());
renewalBatchUpdatePayload = dict("string");
// Fetching the SOAP End Point URL for invoking the service to update Renewal Batch Number
renewalbatchUpdate = bmql("select Username,Password,File_Location,SoapEndpoint from INT_SYSTEM_DETAILS where System = 'Renewal_BATCH_UPDATE'");

for each in renewalbatchUpdate
{
usernameFlagUpdate = get(each,"Username");
passwordFlagUpdate = get(each,"Password");
fileLocationFlagUpdate = get(each,"File_Location");
soapendpointFlagUpdate = get(each,"SoapEndpoint");
}
put(renewalBatchUpdatePayload,"USERNAME", usernameFlagUpdate);
put(renewalBatchUpdatePayload,"PASSWORD", passwordFlagUpdate);
put(renewalBatchUpdatePayload,"Batchnumber", Batch_Number);
put(renewalBatchUpdatePayload,"starttime", Start_Time);
put(renewalBatchUpdatePayload,"endtime", currentsystemDate);
auth="Basic" + " " + passwordFlagUpdate;

defaultErrorMessage="";
quoteRequestRenewalJobUpdate=applytemplate(fileLocationFlagUpdate,renewalBatchUpdatePayload,defaultErrorMessage);

headersDict = dict("string"); 
put(headersDict,"Content-Type","text/xml;charset=UTF-8"); 
put(headersDict,"Authorization",auth);
response="";
//service call to update batch number 
response = urldatabypost(soapendpointFlagUpdate,quoteRequestRenewalJobUpdate, "error",headersDict);


/*
renewalBatchDeployPayload = dict("string");
renewalBatchDeploy = bmql("select Username,Password,File_Location,SoapEndpoint from INT_SYSTEM_DETAILS where System = 'RENEWAL_BATCH_DEPLOY'");

for batchDeploy in renewalBatchDeploy
{
usernameFlagDeploy = get(batchDeploy,"Username");
passwordFlagDeploy = get(batchDeploy,"Password");
fileLocationFlagDeploy = get(batchDeploy,"File_Location");
soapendpointFlagDeploy = get(batchDeploy,"SoapEndpoint");
}
put(renewalBatchDeployPayload,"USERNAME", usernameFlagDeploy);
put(renewalBatchDeployPayload,"PASSWORD", passwordFlagDeploy);
str1=encodebase64("Integration:Welcome@01");


auth="Basic" + " " + passwordFlagDeploy;

defaultErrorMessage="";
quoteRequestRenewalBatchDeploy=applytemplate(fileLocationFlagDeploy,renewalBatchDeployPayload,defaultErrorMessage);

headersDict = dict("string"); 
put(headersDict,"Content-Type","text/xml;charset=UTF-8"); 
put(headersDict,"Authorization",auth);
response="";
response = urldatabypost(soapendpointFlagDeploy,quoteRequestRenewalBatchDeploy, "error",headersDict);


renewalBatchDeployPayload = dict("string");
renewalBatchDeploy = bmql("select Username,Password,File_Location,SoapEndpoint from INT_SYSTEM_DETAILS where System = 'RENEWAL_JOB_DEPLOY'");

for batchDeploy in renewalBatchDeploy
{
usernameFlagDeploy = get(batchDeploy,"Username");
passwordFlagDeploy = get(batchDeploy,"Password");
fileLocationFlagDeploy = get(batchDeploy,"File_Location");
soapendpointFlagDeploy = get(batchDeploy,"SoapEndpoint");
}
put(renewalBatchDeployPayload,"USERNAME", usernameFlagDeploy);
put(renewalBatchDeployPayload,"PASSWORD", passwordFlagDeploy);
str1=encodebase64("Integration:Welcome@01");



auth="Basic" + " " + passwordFlagDeploy;

defaultErrorMessage="";
quoteRequestRenewalBatchDeploy=applytemplate(fileLocationFlagDeploy,renewalBatchDeployPayload,defaultErrorMessage);

headersDict = dict("string"); 
put(headersDict,"Content-Type","text/xml;charset=UTF-8"); 
put(headersDict,"Authorization",auth);
response="";
response = urldatabypost(soapendpointFlagDeploy,quoteRequestRenewalBatchDeploy, "error",headersDict);




*/

return response;