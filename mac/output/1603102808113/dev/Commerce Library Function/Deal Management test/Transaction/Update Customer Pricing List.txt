/******************************************************************************` 
Author : Kavita Lolla
UID-260
User Story Summary : Once Pricing  contracts are approved and activated. 
System should automatically store the contracts in Customer Specific price list 
Data tables and use those prices for all future transactions based on predefined business rules"
Date : 24/01/2019
******************************************************************************/
customerNo = "";
customerDict=Dict("string");
customerNo1 = "";
request="";
// set customer no for contract quote and approved status as transaction customer id else set it as bill to customer id
if(quoteType_t == "contractQuote" and status_t == "APPROVED")
{
 if(_transaction_customer_id<> "")
 {
  customerNo = _transaction_customer_id;
  
 }
 else
 {
  if(billToCustomerId_t <> "")
  {
   customerNo = billToCustomerId_t;
   
  }
  
 }
customerNo1 = customerNo+"~"+_transaction_customer_t_company_name+"~"+bs_id+"~";

 partArray = String[];
 priceArray = Float[];

 i=0;
 // set CPN line level attribute and fetch the proposed price
 for line in transactionLine
 { customerNo1="";
  if(line.lineExpirationDate_l==""){
  sb=stringbuilder(customerNo, "~" ,line.cPN_l ,"~",_transaction_customer_t_company_name,"~",bs_id,"~" , line.effectiveStartDate_l,"~" , quoteExpirationDate_t);
  customerNo1=sbtostring(sb);
  }
  if(line.lineExpirationDate_l<>""){
  sb=stringbuilder(customerNo, "~" ,line.cPN_l ,"~",_transaction_customer_t_company_name,"~",bs_id,"~" , line.effectiveStartDate_l ,"~" , line.lineExpirationDate_l);
  customerNo1=sbtostring(sb);
  } 
  if(line._part_number <> "" AND line._part_number <> "Cust")
  {
  res = findinarray(partArray,line._part_number);
  if(res < 0)
  {
   partArray[i] = line._part_number;
   put(customerDict,line._part_number,customerNo1);
   priceArray[i] = line.proposedNetUnitPriceRequested_l;
   i=i+1;
  }
  else
  {
   if(priceArray[res] <= line.proposedNetUnitPriceRequested_l)
   { put(customerDict,line._part_number,customerNo1);
    priceArray[res] = line.proposedNetUnitPriceRequested_l;
   }
  }
  }
 }
 j=0;
 // call for creating customer pricelist in table
 partSize = sizeofarray(partArray);
 if(customerNo1 <> ""){
 for part in partArray
 {
  priceValue = priceArray[j];
  customerString=get(customerDict,part);
  mod = util.createQuoteRequest_avg(customerString, part, priceValue);
  request=request+mod;
  j = j+1;
 }
 mod_flag=util.modifyCustPriceList_avg(request, "", 0.0);
 //dep_flag = util.deployCustPriceList_avg();
 }

 return true;
}
return false;