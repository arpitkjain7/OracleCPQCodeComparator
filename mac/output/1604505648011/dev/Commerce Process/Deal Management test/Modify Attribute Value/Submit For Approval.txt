//************************************************************************************************************
//** Description: Function fetch the updated value of payment term from OEC on click of submit to order
//**
//** Return type: string dict
//**
//** History:     Date          Author                     Story  -  Comment 
//**              ------------- -----------------------    -------------------------------------------------------------
//**              16/08/2019     Rohit Ranjan              Fetches payment term value on click of submit to order button using rest API for VIPER-22
//************************************************************************************************************
//Initializing the variables

url="";
paymentTerm="";
Credentials="";
partyId=_transaction_customer_id;
// Fetching the credential and path of soap end point, file manager from data table
if(partyId<>""){
 results=bmql("select Username,Password,SoapEndpoint from INT_SYSTEM_DETAILS where System='Create_Opportunity'"); 
 for res in results{
  Credentials_sb=stringbuilder();
  Credentials_sb = sbappend(Credentials_sb, get(res,"Username"), ":", get(res,"Password"));
  Credentials=sbtostring(Credentials_sb);
  url=get(res,"SoapEndpoint");
  }
 //Rest API http method to fetch response based on party ID containing payment term value
  GETURL_sb=stringbuilder();
  GETURL_sb=sbappend(GETURL_sb,url,"/crmRestApi/resources/latest/accounts?q=PartyId="+partyId+"&fields=OrganizationDEO_BRCM_PaymentTerms_c&onlyData=True");
  GETURL=sbtostring(GETURL_sb);  
  
  //Rest API Header details
  headersDict = dict("string"); 
  put(headersDict,"Content-Type","application/json");
  encodecredential=encodebase64(Credentials); 
  authstring="Basic " + encodecredential;
  put(headersDict,"Authorization",authstring);
  paymentResponse=Dict("string");
  paymentResponse = urldata(GETURL,"GET",headersDict, ""); 
  //Converting the response string into json and fetching net payment term value 
  if(isnull(paymentResponse)<>true){
   responseStr= get(paymentResponse,"Message-Body"); 
   responseJsonObj=json(responseStr);
   Payment_termarray=jsonpathgetmultiple(responseJsonObj,"$..OrganizationDEO_BRCM_PaymentTerms_c");  
   if(jsonarraysize(Payment_termarray)>0){
    PaymentTerm=jsonarrayget(Payment_termarray,0);
   }
  }
}
 return PaymentTerm;